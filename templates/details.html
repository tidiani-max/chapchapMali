{% load static %}
{% load humanize %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Produits Details</title>
    <link rel="icon" type="image/png" href="{% static 'images/logo.jpg' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
</head>
<style>
    .swiper-container {
    transition: height 0.3s ease-in-out;
}

</style>

<body class="bg-gray-100">
    <div class="max-w-md mx-auto overflow-hidden">
        <button onclick="window.history.back()" class="text-gray-600 hover:text-gray-900 flex items-center">
            <i class="fas fa-arrow-left text-2xl"></i>
        </button>
        <div class="relative">
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    {% for photo in product.photos.all %}
                    <div class="swiper-slide">
                        <img src="{{ photo.image.url }}" alt="{{ product.name }} Photo" class="w-full" height="300" width="400"/>
                    </div>
                    {% endfor %}
                    {% for video in product.videos.all %}
                    <div class="swiper-slide">
                        <video controls class="w-full" height="300" width="400">
                            <source src="{{ video.video.url }}" type="video/mp4">
                            Votre navigateur ne prend pas en charge la balise vidéo.
                        </video>
                    </div>
                    {% endfor %}
                </div>
                <!-- Add Pagination -->
                <div class="swiper-pagination"></div>
            </div>
            <div class="absolute top-2 right-2 text-white">
                <i class="fas fa-heart"></i>
            </div>
        </div>
        <div class="p-4">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-semibold text-orange-600">fcfa {{ product.price|intcomma }}</h2>
                <p class="text-gray-500 text-sm">{{ product.date_posted }}</p>
            </div>
            <p class="text-gray-700 mt-1 ">{{ product.name }}</p>
            <p class="text-gray-500 text-sm mt-1">
                <i class="fas fa-map-marker-alt text-orange-600"></i>  {{ product.get_address }}
            </p>
            <div class="mt-4">
                <h3 class="text-gray-700 font-semibold">Description</h3>
                <p class="text-gray-700 mt-1">
                    {{ product.description }}
                </p>
            </div>
            {% if profile and profile.profile_picture %}
            <img alt="Profile image of the user" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover border-2 border-gray-300"
                 src="{{ profile.profile_picture.url }}" />
        {% else %}
            <img alt="Default profile image" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover border-2 border-gray-300"
                 src="{% static 'images/default_profile.png' %}" />
        {% endif %}        
            <h3 class="text-gray-700 font-semibold">Produit publiée à</h3>
            <iframe 
                class="w-full mt-2 rounded-lg" 
                height="300" 
                src="https://www.google.com/maps?q={{ product.latitude }},{{ product.longitude }}&output=embed" 
                allowfullscreen>
            </iframe>
            
            </div>
        </div>
        <div class="flex justify-around p-4 border-t">
            {% if product.user != request.user %}
                <a href="{% url 'chat:start_or_continue_chat' product.id %}" 
                class="bg-green-500 text-white px-4 py-2 rounded-lg">
                    Chat
                </a>
            {% endif %}

           
        </div>
    </div>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        var swiper = new Swiper('.swiper-container', {
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            observer: true, // Enables dynamic observation of changes
            observeParents: true, // Observes parent element changes
            autoHeight: true, // Adjusts height based on active slide
        });
    </script>    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            document.cookie = "user_timezone=" + userTimeZone + "; path=/";
        });
    </script>
    
</body>
</html>